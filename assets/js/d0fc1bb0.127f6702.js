"use strict";(self.webpackChunkforge_samples_docs=self.webpackChunkforge_samples_docs||[]).push([[540],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return m}});var o=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=o.createContext({}),d=function(e){var n=o.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},u=function(e){var n=d(e.components);return o.createElement(l.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},p=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=d(t),m=r,g=p["".concat(l,".").concat(m)]||p[m]||c[m]||i;return t?o.createElement(g,a(a({ref:n},u),{},{components:t})):o.createElement(g,a({ref:n},u))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,a=new Array(i);a[0]=p;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,a[1]=s;for(var d=2;d<i;d++)a[d]=t[d];return o.createElement.apply(null,a)}return o.createElement.apply(null,t)}p.displayName="MDXCreateElement"},3039:function(e,n,t){t.r(n),t.d(n,{assets:function(){return u},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return s},metadata:function(){return d},toc:function(){return c}});var o=t(7462),r=t(3366),i=(t(7294),t(3905)),a=["components"],s={sidebar_position:1},l="Basic Extension",d={unversionedId:"tutorials/dashboard/basic",id:"tutorials/dashboard/basic",title:"Basic Extension",description:"Forge Viewer provides its own set of APIs",source:"@site/docs/tutorials/03-dashboard/01-basic.md",sourceDirName:"tutorials/03-dashboard",slug:"/tutorials/dashboard/basic",permalink:"/forge-samples-docs/docs/tutorials/dashboard/basic",editUrl:"https://github.com/petrbroz/forge-samples-docs/edit/master/docs/tutorials/03-dashboard/01-basic.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Introduction",permalink:"/forge-samples-docs/docs/tutorials/dashboard/"}},u={},c=[{value:"Extension skeleton",id:"extension-skeleton",level:2},{value:"Extracting metadata",id:"extracting-metadata",level:2},{value:"Aggregating information",id:"aggregating-information",level:2},{value:"Try it out",id:"try-it-out",level:2}],p={toc:c};function m(e){var n=e.components,s=(0,r.Z)(e,a);return(0,i.kt)("wrapper",(0,o.Z)({},p,s,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"basic-extension"},"Basic Extension"),(0,i.kt)("p",null,"Forge Viewer provides its own set of ",(0,i.kt)("a",{parentName:"p",href:"https://forge.autodesk.com/en/docs/viewer/v7/reference/Viewing/Viewer3D"},"APIs"),"\nthat you can use to customize its look and feel, behavior, and even the rendered content."),(0,i.kt)("p",null,"While you ",(0,i.kt)("em",{parentName:"p"},"could")," just start sprinkling your viewer customization code here and there, it is a good practice\nto encapsulate custom viewer functionality into a ",(0,i.kt)("em",{parentName:"p"},"viewer extension"),". That way you can easily share the same\nfunctionality across different pages of your web application, and even across different projects entirely."),(0,i.kt)("p",null,"Let's start by implementing a simple viewer extension that will extract different types of information\nfrom the currently loaded design. Later on we will implement additional extensions that will display this\ninformation in different ways."),(0,i.kt)("div",{className:"admonition admonition-important alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"important")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The client side assets we will be working with in this tutorial may be located in different folders\ndepending on the codebase you are starting with. If you have followed the .NET tutorials,\nclient side assets are stored in the ",(0,i.kt)("strong",{parentName:"p"},"wwwroot")," folder. If you have followed the Node.js tutorials,\nclient side assets will be stored in the ",(0,i.kt)("strong",{parentName:"p"},"public")," folder."))),(0,i.kt)("h2",{id:"extension-skeleton"},"Extension skeleton"),(0,i.kt)("p",null,"Go to the folder that contains your client side assets (such as the ",(0,i.kt)("inlineCode",{parentName:"p"},"main.js")," script or the ",(0,i.kt)("inlineCode",{parentName:"p"},"viewer.js")," script),\nand create a new subfolder called ",(0,i.kt)("inlineCode",{parentName:"p"},"extensions"),". This is where we will store all our viewer extensions.\nIn the ",(0,i.kt)("inlineCode",{parentName:"p"},"extensions")," folder, create a new file called ",(0,i.kt)("inlineCode",{parentName:"p"},"summary.js"),", and populate it with the following content:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="{wwwroot|public}/extensions/summary.js"',title:'"{wwwroot|public}/extensions/summary.js"'},"export class SummaryExtension extends Autodesk.Viewing.Extension {\n    constructor(viewer, options) {\n        super(viewer, options);\n    }\n\n    load() {\n        console.log('SummaryExtension loaded.');\n        return true;\n    }\n\n    unload() {\n        console.log('SummaryExtension unloaded.');\n        return true;\n    }\n}\n\nAutodesk.Viewing.theExtensionManager.registerExtension('SummaryExtension', SummaryExtension);\n")),(0,i.kt)("p",null,"As you can see, a viewer extension is basically a subclass of ",(0,i.kt)("a",{parentName:"p",href:"https://forge.autodesk.com/en/docs/viewer/v7/reference/Viewing/Extension"},"Autodesk.Viewing.Extension"),"\nthat overrides some of its lifecycle methods. For now we have only overridden the following methods:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"load")," - called when the extension is loaded by the viewer, returning a boolean flag indicating whether the loading was successful"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"unload")," - called when the extension is unloaded by the viewer, returning a boolean flag indicating whether the unloading was successful")),(0,i.kt)("p",null,"We also ",(0,i.kt)("strong",{parentName:"p"},"register")," the extension under a specific unique ID so that the viewer is aware of it. This is done via\na singleton class called ",(0,i.kt)("inlineCode",{parentName:"p"},"Autodesk.Viewing.theExtensionManager")," and its ",(0,i.kt)("inlineCode",{parentName:"p"},"registerExtension(extensionId, extensionClass)")," method."),(0,i.kt)("p",null,"Now, let's just import the extension script into our ",(0,i.kt)("inlineCode",{parentName:"p"},"viewer.js")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="{wwwroot|public}/viewer.js"',title:'"{wwwroot|public}/viewer.js"'},"/// import * as Autodesk from \"@types/forge-viewer\";\n\n// highlight-start\nimport './extensions/summary.js';\n// highlight-end\n\n// ...\n\nexport async function initViewer(container) {\n    return new Promise(function (resolve, reject) {\n        Autodesk.Viewing.Initializer({ getAccessToken }, async function () {\n            // highlight-start\n            const config = {\n                extensions: ['SummaryExtension']\n            };\n            // highlight-end\n            const viewer = new Autodesk.Viewing.GuiViewer3D(container, config);\n            viewer.start();\n            viewer.setTheme('light-theme');\n            resolve(viewer);\n        });\n    });\n}\n\n// ...\n")),(0,i.kt)("h2",{id:"extracting-metadata"},"Extracting metadata"),(0,i.kt)("p",null,"Now let's add some custom functionality to our extension. We will start with two helper methods,\none that will traverse the object hierarchy of a design and return all ",(0,i.kt)("em",{parentName:"p"},"leaf objects")," (that is,\nobjects that do not have any other children), and another one that will retrieve the names of all\nproperties found on all objects in the model. Add the following two methods in your ",(0,i.kt)("inlineCode",{parentName:"p"},"summary.js")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="{wwwroot|public}/extensions/summary.js"',title:'"{wwwroot|public}/extensions/summary.js"'},"export class SummaryExtension extends Autodesk.Viewing.Extension {\n    constructor(viewer, options) {\n        super(viewer, options);\n    }\n\n    load() {\n        console.log('SummaryExtension loaded.');\n        return true;\n    }\n\n    unload() {\n        console.log('SummaryExtension unloaded.');\n        return true;\n    }\n\n    // highlight-start\n    /**\n     * Finds all leaf objects (that is, objects that do not have any children)\n     * in the object hierarchy of a model.\n     * @async\n     * @param {Autodesk.Viewing.Model} model Forge model.\n     * @returns {Promise<number[]>} IDs of all leaf objects.\n     */\n    findLeafNodes(model) {\n        return new Promise(function (resolve, reject) {\n            model.getObjectTree(function (tree) {\n                let leaves = [];\n                tree.enumNodeChildren(tree.getRootId(), function (dbid) {\n                    if (tree.getChildCount(dbid) === 0) {\n                        leaves.push(dbid);\n                    }\n                }, true);\n                resolve(leaves);\n            }, reject);\n        });\n    }\n    // highlight-end\n\n    // highlight-start\n    /**\n     * Finds names of all properties available in a model.\n     * @async\n     * @param {Autodesk.Viewing.Model} model Forge model.\n     * @returns {Promise<string[]>} List of property names.\n     */\n    async findPropertyNames(model) {\n        const dbids = await this.findLeafNodes(model);\n        return new Promise(function (resolve, reject) {\n            model.getBulkProperties(dbids, {}, function (results) {\n                let propNames = new Set();\n                for (const result of results) {\n                    for (const prop of result.properties) {\n                        propNames.add(prop.displayName);\n                    }\n                }\n                resolve(Array.from(propNames.values()));\n            }, reject);\n        });\n    }\n    // highlight-end\n}\n\nAutodesk.Viewing.theExtensionManager.registerExtension('SummaryExtension', SummaryExtension);\n")),(0,i.kt)("p",null,"Here we're already using some of the first viewer APIs such as:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://forge.autodesk.com/en/docs/viewer/v7/reference/Viewing/Model/#getobjecttree-onsuccesscallback-onerrorcallback"},"Model#getObjectTree"),' - used to\nretrieve the object hierarchy (sometimes called an "instance tree") of the model'),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://forge.autodesk.com/en/docs/viewer/v7/reference/Viewing/Model/#getbulkproperties-dbids-options-onsuccesscallback-onerrorcallback"},"Model#getBulkProperties")," - used to\nretrieve the metadata for one or more objects"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://forge.autodesk.com/en/docs/viewer/v7/reference/Private/InstanceTree/#getrootid"},"InstanceTree#getRootId")," - returning the ID of the root object"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://forge.autodesk.com/en/docs/viewer/v7/reference/Private/InstanceTree/#enumnodechildren-node-callback-recursive"},"InstanceTree#enumNodeChildren")," - used to\nenumerate (recursively) all children of a specific object")),(0,i.kt)("h2",{id:"aggregating-information"},"Aggregating information"),(0,i.kt)("p",null,"Let's finalize our first extension by adding two more methods: one for finding all the values\nthat appear for a specific property (incl. the list of object IDs where this value is set),\nand another one for aggregating the values of a specific property across a list of objects.\nAdd the following code to the ",(0,i.kt)("inlineCode",{parentName:"p"},"summary.js")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="{wwwroot|public}/extensions/summary.js"',title:'"{wwwroot|public}/extensions/summary.js"'},"export class SummaryExtension extends Autodesk.Viewing.Extension {\n    constructor(viewer, options) {\n        super(viewer, options);\n    }\n\n    load() {\n        console.log('SummaryExtension loaded.');\n        return true;\n    }\n\n    unload() {\n        console.log('SummaryExtension unloaded.');\n        return true;\n    }\n\n    /**\n     * Finds all leaf objects (that is, objects that do not have any children)\n     * in the object hierarchy of a model.\n     * @async\n     * @param {Autodesk.Viewing.Model} model Forge model.\n     * @returns {Promise<number[]>} IDs of all leaf objects.\n     */\n    findLeafNodes(model) {\n        return new Promise(function (resolve, reject) {\n            model.getObjectTree(function (tree) {\n                let leaves = [];\n                tree.enumNodeChildren(tree.getRootId(), function (dbid) {\n                    if (tree.getChildCount(dbid) === 0) {\n                        leaves.push(dbid);\n                    }\n                }, true);\n                resolve(leaves);\n            }, reject);\n        });\n    }\n\n    /**\n     * Finds names of all properties available in a model.\n     * @async\n     * @param {Autodesk.Viewing.Model} model Forge model.\n     * @returns {Promise<string[]>} List of property names.\n     */\n    async findPropertyNames(model) {\n        const dbids = await this.findLeafNodes(model);\n        return new Promise(function (resolve, reject) {\n            model.getBulkProperties(dbids, {}, function (results) {\n                let propNames = new Set();\n                for (const result of results) {\n                    for (const prop of result.properties) {\n                        propNames.add(prop.displayName);\n                    }\n                }\n                resolve(Array.from(propNames.values()));\n            }, reject);\n        });\n    }\n\n    // highlight-start\n    /**\n     * Finds all the different values that appear for a specific property,\n     * together with a list of IDs of objects that contain these values.\n     * @async\n     * @param {Autodesk.Viewing.Model} model Forge model.\n     * @param {string} propertyName Name of property to compute the histogram for.\n     * @returns {Promise<Map<string, number[]>>} Mapping of property values to lists of object IDs that contain these values.\n     */\n    async computePropertyHistogram(model, propertyName) {\n        const dbids = await this.findLeafNodes(model);\n        return new Promise(function (resolve, reject) {\n            model.getBulkProperties(dbids, { propFilter: [propertyName] }, function (results) {\n                let histogram = new Map();\n                for (const result of results) {\n                    if (result.properties.length > 0) {\n                        const key = result.properties[0].displayValue;\n                        if (histogram.has(key)) {\n                            histogram.get(key).push(result.dbId);\n                        } else {\n                            histogram.set(key, [result.dbId]);\n                        }\n                    }\n                }\n                resolve(histogram);\n            }, reject);\n        });\n    }\n    // highlight-end\n\n    // highlight-start\n    /**\n     * Aggregates values of a specific property from a range of objects, using a specific aggregating function.\n     * @async\n     * @param {Autodesk.Viewing.Model} model Forge model.\n     * @param {number[]} [dbids] Optional list of object IDs to include in the aggregation (by default, all objects are included).\n     * @param {string} propertyName Name of property whose values will be aggregated.\n     * @param {(aggregateValue: number, currentValue: number, property) => number} aggregateFunc Aggregating function for the property values.\n     * For example, `(sum, current, prop) => { return sum + current; }`.\n     * @param {number} initialValue Initial value for the aggregating function.\n     * @returns {Promise<number>} Final aggregated value.\n     */\n    async aggregatePropertyValues(model, dbids, propertyName, aggregateFunc, initialValue = 0) {\n        if (!dbids) {\n            dbids = await this.findLeafNodes(model);\n        }\n        return new Promise(function (resolve, reject) {\n            let aggregatedValue = initialValue;\n            model.getBulkProperties(dbids, { propFilter: [propertyName] }, function (results) {\n                for (const result of results) {\n                    if (result.properties.length > 0) {\n                        const prop = result.properties[0];\n                        aggregatedValue = aggregateFunc(aggregatedValue, prop.displayValue, prop);\n                    }\n                }\n                resolve(aggregatedValue);\n            }, reject);\n        });\n    }\n    // highlight-end\n}\n\nAutodesk.Viewing.theExtensionManager.registerExtension('SummaryExtension', SummaryExtension);\n")),(0,i.kt)("h2",{id:"try-it-out"},"Try it out"),(0,i.kt)("p",null,"Alright, our first extension is now ready to use. It doesn't have any user interface but we can\ntest it out directly in the browser."),(0,i.kt)("p",null,"Start your application as usual (again, this will depend on which of the tutorials you followed),\nopen it in your browser, and open the browser's console."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"All the modern browsers provide ",(0,i.kt)("em",{parentName:"p"},"developer tools"),", incl. a console, that you can use to debug\nyour web applications. Look for the instructions for the specific browser of your choice on how\nthese tools can be accessed."))),(0,i.kt)("p",null,"In the console, run the following commands:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"let summaryExt = NOP_VIEWER.getExtension('SummaryExtension');\nsummaryExt.findPropertyNames(NOP_VIEWER.model).then(console.log).catch(console.error);\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"NOP_VIEWER")," is a reference to the current instance of ",(0,i.kt)("a",{parentName:"p",href:"https://forge.autodesk.com/en/docs/viewer/v7/reference/Viewing/Viewer3D"},"Autodesk.Viewing.Viewer3D"),"\nthat you can use to quickly debug or experiment with the viewer APIs in the browser console."),(0,i.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"We do not recommend using ",(0,i.kt)("inlineCode",{parentName:"p"},"NOP_VIEWER")," in production code!"))),(0,i.kt)("p",null,"Since we have already configured the viewer to load our ",(0,i.kt)("inlineCode",{parentName:"p"},"SummaryExtension")," during the viewer's\ninitialization, we can simply retrieve the extension object using the ",(0,i.kt)("inlineCode",{parentName:"p"},"getExtension")," method.\nAnd since the ",(0,i.kt)("inlineCode",{parentName:"p"},"findPropertyNames")," method on our extension returns a promise, we simply chain\nthe outputs to either ",(0,i.kt)("inlineCode",{parentName:"p"},"console.log")," (if the promise is fulfilled) or ",(0,i.kt)("inlineCode",{parentName:"p"},"console.error")," (if the\npromise is rejected)."),(0,i.kt)("p",null,"You will receive different results depending on the type of model you have loaded in the viewer.\nIn my case it was a Fusion 360 model, and the extension returned the following result"),(0,i.kt)("p",null,(0,i.kt)("img",{loading:"lazy",alt:"Summary Result",src:t(3089).Z,width:"1500",height:"989"})))}m.isMDXComponent=!0},3089:function(e,n,t){n.Z=t.p+"assets/images/summary-result-3af6afefdc9c70461bfd1a5ea6e0fd59.png"}}]);