"use strict";(self.webpackChunkforge_samples_docs=self.webpackChunkforge_samples_docs||[]).push([[79],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return m}});var o=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,i=function(e,n){if(null==e)return{};var t,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=o.createContext({}),d=function(e){var n=o.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},p=function(e){var n=d(e.components);return o.createElement(s.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},u=o.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=d(t),m=i,w=u["".concat(s,".").concat(m)]||u[m]||c[m]||r;return t?o.createElement(w,a(a({ref:n},p),{},{components:t})):o.createElement(w,a({ref:n},p))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,a=new Array(r);a[0]=u;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,a[1]=l;for(var d=2;d<r;d++)a[d]=t[d];return o.createElement.apply(null,a)}return o.createElement.apply(null,t)}u.displayName="MDXCreateElement"},2230:function(e,n,t){t.d(n,{ZP:function(){return s}});var o=t(7462),i=t(3366),r=(t(7294),t(3905)),a=["components"],l={toc:[]};function s(e){var n=e.components,t=(0,i.Z)(e,a);return(0,r.kt)("wrapper",(0,o.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Let's start by implementing the Forge Viewer functionality for our application.\nCreate a ",(0,r.kt)("inlineCode",{parentName:"p"},"viewer.js")," file under the ",(0,r.kt)("inlineCode",{parentName:"p"},"wwwroot")," subfolder with the following code:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="wwwroot/viewer.js"',title:'"wwwroot/viewer.js"'},"/// import * as Autodesk from \"@types/forge-viewer\";\n\nasync function getAccessToken(callback) {\n    try {\n        const resp = await fetch('/api/auth/token');\n        if (!resp.ok) {\n            throw new Error(await resp.text());\n        }\n        const { access_token, expires_in } = await resp.json();\n        callback(access_token, expires_in);\n    } catch (err) {\n        alert('Could not obtain access token. See the console for more details.');\n        console.error(err);\n    }\n}\n\nexport function initViewer(container) {\n    return new Promise(function (resolve, reject) {\n        Autodesk.Viewing.Initializer({ getAccessToken }, function () {\n            const config = {\n                extensions: ['Autodesk.DocumentBrowser']\n            };\n            const viewer = new Autodesk.Viewing.GuiViewer3D(container, config);\n            viewer.start();\n            viewer.setTheme('light-theme');\n            resolve(viewer);\n        });\n    });\n}\n\nexport function loadModel(viewer, urn) {\n    return new Promise(function (resolve, reject) {\n        function onDocumentLoadSuccess(doc) {\n            resolve(viewer.loadDocumentNode(doc, doc.getRoot().getDefaultGeometry()));\n        }\n        function onDocumentLoadFailure(code, message, errors) {\n            reject({ code, message, errors });\n        }\n        viewer.setLightPreset(0);\n        Autodesk.Viewing.Document.load('urn:' + urn, onDocumentLoadSuccess, onDocumentLoadFailure);\n    });\n}\n")),(0,r.kt)("p",null,"The script is an ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules"},"ES6 module"),"\nthat exports two functions, ",(0,r.kt)("inlineCode",{parentName:"p"},"initViewer")," that will create a new instance of Forge Viewer\nin the specified DOM container, and ",(0,r.kt)("inlineCode",{parentName:"p"},"loadModel")," which will load a specific model to the viewer.\nWhen initializing the viewer we include a small helper function (",(0,r.kt)("inlineCode",{parentName:"p"},"getAccessToken"),") that\nretrieves a public token from our server application. The viewer can then use this token\nto start loading assets from the Model Derivative service."))}s.isMDXComponent=!0},17:function(e,n,t){t.d(n,{ZP:function(){return s}});var o=t(7462),i=t(3366),r=(t(7294),t(3905)),a=["components"],l={toc:[]};function s(e){var n=e.components,t=(0,i.Z)(e,a);return(0,r.kt)("wrapper",(0,o.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Next, let's define the logic of the web application itself. We will need to populate\nthe UI with all models available for viewing, as well as add UI for uploading and\ntranslating new models. Create a ",(0,r.kt)("inlineCode",{parentName:"p"},"main.js")," file under the ",(0,r.kt)("inlineCode",{parentName:"p"},"wwwroot")," subfolder with the following code:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="wwwroot/main.js"',title:'"wwwroot/main.js"'},"import { initViewer, loadModel } from './viewer.js';\n\ninitViewer(document.getElementById('preview')).then(viewer => {\n    const urn = window.location.hash?.substring(1);\n    setupModelSelection(viewer, urn);\n    setupModelUpload(viewer);\n});\n\nasync function setupModelSelection(viewer, selectedUrn) {\n    const dropdown = document.getElementById('models');\n    dropdown.innerHTML = '';\n    try {\n        const resp = await fetch('/api/models');\n        if (!resp.ok) {\n            throw new Error(await resp.text());\n        }\n        const models = await resp.json();\n        dropdown.innerHTML = models.map(model => `<option value=${model.urn} ${model.urn === selectedUrn ? 'selected' : ''}>${model.name}</option>`).join('\\n');\n        dropdown.onchange = () => onModelSelected(viewer, dropdown.value);\n        if (dropdown.value) {\n            onModelSelected(viewer, dropdown.value);\n        }\n    } catch (err) {\n        alert('Could not list models. See the console for more details.');\n        console.error(err);\n    }\n}\n\nasync function setupModelUpload(viewer) {\n    const upload = document.getElementById('upload');\n    const input = document.getElementById('input');\n    const models = document.getElementById('models');\n    upload.onclick = () => input.click();\n    input.onchange = async () => {\n        const file = input.files[0];\n        let data = new FormData();\n        data.append('model-file', file);\n        if (file.name.endsWith('.zip')) { // When uploading a zip file, ask for the main design file in the archive\n            const entrypoint = window.prompt('Please enter the filename of the main design inside the archive.');\n            data.append('model-zip-entrypoint', entrypoint);\n        }\n        upload.setAttribute('disabled', 'true');\n        models.setAttribute('disabled', 'true');\n        showNotification(`Uploading model <em>${file.name}</em>. Do not reload the page.`);\n        try {\n            const resp = await fetch('/api/models', { method: 'POST', body: data });\n            if (!resp.ok) {\n                throw new Error(await resp.text());\n            }\n            const model = await resp.json();\n            setupModelSelection(viewer, model.urn);\n        } catch (err) {\n            alert(`Could not upload model ${file.name}. See the console for more details.`);\n            console.error(err);\n        } finally {\n            clearNotification();\n            upload.removeAttribute('disabled');\n            models.removeAttribute('disabled');\n            input.value = '';\n        }\n    };\n}\n\nasync function onModelSelected(viewer, urn) {\n    if (window.onModelSelectedTimeout) {\n        clearTimeout(window.onModelSelectedTimeout);\n        delete window.onModelSelectedTimeout;\n    }\n    window.location.hash = urn;\n    try {\n        const resp = await fetch(`/api/models/${urn}/status`);\n        if (!resp.ok) {\n            throw new Error(await resp.text());\n        }\n        const status = await resp.json();\n        switch (status.status) {\n            case 'n/a':\n                showNotification(`Model has not been translated.`);\n                break;\n            case 'inprogress':\n                showNotification(`Model is being translated (${status.progress})...`);\n                window.onModelSelectedTimeout = setTimeout(onModelSelected, 5000, viewer, urn);\n                break;\n            case 'failed':\n                showNotification(`Translation failed. <ul>${status.messages.map(msg => `<li>${JSON.stringify(msg)}</li>`).join('')}</ul>`);\n                break;\n            default:\n                clearNotification();\n                loadModel(viewer, urn);\n                break; \n        }\n    } catch (err) {\n        alert('Could not load model. See the console for more details.');\n        console.error(err);\n    }\n}\n\nfunction showNotification(message) {\n    const overlay = document.getElementById('overlay');\n    overlay.innerHTML = `<div class=\"notification\">${message}</div>`;\n    overlay.style.display = 'flex';\n}\n\nfunction clearNotification() {\n    const overlay = document.getElementById('overlay');\n    overlay.innerHTML = '';\n    overlay.style.display = 'none';\n}\n")),(0,r.kt)("p",null,"The scripts will initialize the viewer, populate a dropdown element in the UI with models\nretrieved from the ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/models")," endpoint, and setup the file upload. And when one of the models\nin the dropdown is selected, the app logic will check the status of the model in Forge (for example,\nwhether it's still being translated, or whether the translation failed), and load the model when\nit's available."))}s.isMDXComponent=!0},9791:function(e,n,t){t.d(n,{ZP:function(){return s}});var o=t(7462),i=t(3366),r=(t(7294),t(3905)),a=["components"],l={toc:[]};function s(e){var n=e.components,t=(0,i.Z)(e,a);return(0,r.kt)("wrapper",(0,o.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Finally, let's define the UI of our application with a simple HTML markup and CSS."),(0,r.kt)("p",null,"Create an ",(0,r.kt)("inlineCode",{parentName:"p"},"index.html")," file in the ",(0,r.kt)("inlineCode",{parentName:"p"},"wwwroot")," subfolder with the following content:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html",metastring:'title="wwwroot/index.html"',title:'"wwwroot/index.html"'},'<!DOCTYPE html>\n<html lang="en">\n\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <meta http-equiv="X-UA-Compatible" content="ie=edge">\n    <link rel="stylesheet" href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/style.css">\n    <link rel="stylesheet" href="/main.css">\n    <title>Autodesk Forge: Simple Viewer</title>\n</head>\n\n<body>\n    <div id="header">\n        <img class="logo" src="/logo.png" alt="Autodesk Forge">\n        <span class="title">Simple Viewer</span>\n        <select name="models" id="models"></select>\n        <button id="upload" title="Upload New Model">Upload</button>\n        <input style="display: none" type="file" id="input">\n    </div>\n    <div id="preview"></div>\n    <div id="overlay"></div>\n    <script src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/viewer3D.js"><\/script>\n    <script src="/main.js" type="module"><\/script>\n</body>\n\n</html>\n')),(0,r.kt)("p",null,"The HTML markup simply uses a ",(0,r.kt)("inlineCode",{parentName:"p"},"<select>")," element as the dropdown for listing the viewable models,\nand an ",(0,r.kt)("inlineCode",{parentName:"p"},'<input type="file">')," element with a ",(0,r.kt)("inlineCode",{parentName:"p"},"<button>")," to handle the uploading of a new model."),(0,r.kt)("p",null,"Create a ",(0,r.kt)("inlineCode",{parentName:"p"},"main.css")," file, also under the ",(0,r.kt)("inlineCode",{parentName:"p"},"wwwroot")," subfolder, and populate it with these CSS rules:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-css",metastring:'title="wwwroot/main.css"',title:'"wwwroot/main.css"'},"body, html {\n    margin: 0;\n    padding: 0;\n    height: 100vh;\n    font-family: ArtifaktElement; /* Will be added by Forge Viewer */\n}\n\n#header, #preview, #overlay {\n    position: absolute;\n    width: 100%;\n}\n\n#header {\n    height: 3em;\n    display: flex;\n    flex-flow: row nowrap;\n    justify-content: space-between;\n    align-items: center;\n}\n\n#preview, #overlay {\n    top: 3em;\n    bottom: 0;\n}\n\n#overlay {\n    z-index: 1;\n    background-color: rgba(0, 0, 0, 0.5);\n    padding: 1em;\n    display: none;\n}\n\n#overlay > .notification {\n    margin: auto;\n    padding: 1em;\n    max-width: 50%;\n    background: white;\n}\n\n#header > * {\n    height: 2em;\n    margin: 0 0.5em;\n    font-size: 1em;\n    font-family: ArtifaktElement;\n}\n\n#header .title {\n    flex: 1 0 auto;\n    height: auto;\n}\n\n#models {\n    flex: 0 1 auto;\n    min-width: 2em;\n}\n")),(0,r.kt)("p",null,"The application will look for ",(0,r.kt)("inlineCode",{parentName:"p"},"favicon.ico")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"logo.png")," images under the ",(0,r.kt)("inlineCode",{parentName:"p"},"wwwroot")," folder\nto use as the website's icon and logo. If you don't have any images of your own, feel free\nto download them from one of our samples:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://raw.githubusercontent.com/petrbroz/forge-simple-viewer-nodejs/develop/public/favicon.ico"},"https://raw.githubusercontent.com/petrbroz/forge-simple-viewer-nodejs/develop/public/favicon.ico")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://raw.githubusercontent.com/petrbroz/forge-simple-viewer-nodejs/develop/public/logo.png"},"https://raw.githubusercontent.com/petrbroz/forge-simple-viewer-nodejs/develop/public/logo.png"))))}s.isMDXComponent=!0},6105:function(e,n,t){t.r(n),t.d(n,{assets:function(){return m},contentTitle:function(){return c},default:function(){return h},frontMatter:function(){return p},metadata:function(){return u},toc:function(){return w}});var o=t(7462),i=t(3366),r=(t(7294),t(3905)),a=t(2230),l=t(17),s=t(9791),d=["components"],p={sidebar_position:4},c="Viewer & UI",u={unversionedId:"tutorials/simple-viewer/dotnet-vs2022/viewer",id:"tutorials/simple-viewer/dotnet-vs2022/viewer",title:"Viewer & UI",description:"Finally, we're ready to build the client-side piece of our application.",source:"@site/docs/tutorials/01-simple-viewer/dotnet-vs2022/04-viewer.mdx",sourceDirName:"tutorials/01-simple-viewer/dotnet-vs2022",slug:"/tutorials/simple-viewer/dotnet-vs2022/viewer",permalink:"/forge-samples-docs/docs/tutorials/simple-viewer/dotnet-vs2022/viewer",editUrl:"https://github.com/petrbroz/forge-samples-docs/edit/master/docs/tutorials/01-simple-viewer/dotnet-vs2022/04-viewer.mdx",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Model Management",permalink:"/forge-samples-docs/docs/tutorials/simple-viewer/dotnet-vs2022/models"},next:{title:"Introduction",permalink:"/forge-samples-docs/docs/tutorials/hubs-browser/"}},m={},w=[{value:"Viewer logic",id:"viewer-logic",level:2},{value:"Application logic",id:"application-logic",level:2},{value:"User interface",id:"user-interface",level:2},{value:"Try it out",id:"try-it-out",level:2}],f={toc:w};function h(e){var n=e.components,p=(0,i.Z)(e,d);return(0,r.kt)("wrapper",(0,o.Z)({},f,p,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"viewer--ui"},"Viewer & UI"),(0,r.kt)("p",null,"Finally, we're ready to build the client-side piece of our application."),(0,r.kt)("h2",{id:"viewer-logic"},"Viewer logic"),(0,r.kt)(a.ZP,{mdxType:"ViewerLogic"}),(0,r.kt)("h2",{id:"application-logic"},"Application logic"),(0,r.kt)(l.ZP,{mdxType:"AppLogic"}),(0,r.kt)("h2",{id:"user-interface"},"User interface"),(0,r.kt)(s.ZP,{mdxType:"UiSetup"}),(0,r.kt)("h2",{id:"try-it-out"},"Try it out"),(0,r.kt)("p",null,"And that's it! Your application is now ready for action. Start it from Visual Studio, and then navigate\nto ",(0,r.kt)("a",{parentName:"p",href:"http://localhost:8080"},"http://localhost:8080")," in your browser. You should be presented with a simple UI,\nwith a dropdown in the top-right corner that will eventually get populated with all models available in your\nconfigured bucket, and with a button for uploading new models. And as soon as you select one of the options\nfrom the dropdown, the corresponding model will get loaded in the viewer occupying the rest of the webpage."),(0,r.kt)("p",null,(0,r.kt)("img",{loading:"lazy",alt:"Final App",src:t(6857).Z,width:"1500",height:"929"})))}h.isMDXComponent=!0},6857:function(e,n,t){n.Z=t.p+"assets/images/final-app-e64fd5413d7175cc6b25650127d64f6a.png"}}]);