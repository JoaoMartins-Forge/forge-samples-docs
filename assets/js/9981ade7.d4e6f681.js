"use strict";(self.webpackChunkforge_samples_docs=self.webpackChunkforge_samples_docs||[]).push([[759],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return h}});var r=t(7294);function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,s=function(e,n){if(null==e)return{};var t,r,s={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var l=r.createContext({}),u=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},c=function(e){var n=u(e.components);return r.createElement(l.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,s=e.mdxType,o=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=u(t),h=s,g=d["".concat(l,".").concat(h)]||d[h]||p[h]||o;return t?r.createElement(g,a(a({ref:n},c),{},{components:t})):r.createElement(g,a({ref:n},c))}));function h(e,n){var t=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var o=t.length,a=new Array(o);a[0]=d;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i.mdxType="string"==typeof e?e:s,a[1]=i;for(var u=2;u<o;u++)a[u]=t[u];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},8843:function(e,n,t){t.d(n,{Z:function(){return d}});var r=t(7294),s=t(7462),o=t(2389),a=t(9366),i=t(6010),l="tabItem_LplD";function u(e){var n,t,o,u=e.lazy,c=e.block,p=e.defaultValue,d=e.values,h=e.groupId,g=e.className,b=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),f=null!=d?d:b.map((function(e){var n=e.props;return{value:n.value,label:n.label,attributes:n.attributes}})),m=(0,a.lx)(f,(function(e,n){return e.value===n.value}));if(m.length>0)throw new Error('Docusaurus error: Duplicate values "'+m.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var v=null===p?p:null!=(n=null!=p?p:null==(t=b.find((function(e){return e.props.default})))?void 0:t.props.value)?n:null==(o=b[0])?void 0:o.props.value;if(null!==v&&!f.some((function(e){return e.value===v})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+v+'" but none of its children has the corresponding value. Available values are: '+f.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var k=(0,a.UB)(),y=k.tabGroupChoices,w=k.setTabGroupChoices,C=(0,r.useState)(v),j=C[0],T=C[1],_=[],I=(0,a.o5)().blockElementScrollPositionUntilNextRender;if(null!=h){var A=y[h];null!=A&&A!==j&&f.some((function(e){return e.value===A}))&&T(A)}var E=function(e){var n=e.currentTarget,t=_.indexOf(n),r=f[t].value;r!==j&&(I(n),T(r),null!=h&&w(h,r))},N=function(e){var n,t=null;switch(e.key){case"ArrowRight":var r=_.indexOf(e.currentTarget)+1;t=_[r]||_[0];break;case"ArrowLeft":var s=_.indexOf(e.currentTarget)-1;t=_[s]||_[_.length-1]}null==(n=t)||n.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":c},g)},f.map((function(e){var n=e.value,t=e.label,o=e.attributes;return r.createElement("li",(0,s.Z)({role:"tab",tabIndex:j===n?0:-1,"aria-selected":j===n,key:n,ref:function(e){return _.push(e)},onKeyDown:N,onFocus:E,onClick:E},o,{className:(0,i.Z)("tabs__item",l,null==o?void 0:o.className,{"tabs__item--active":j===n})}),null!=t?t:n)}))),u?(0,r.cloneElement)(b.filter((function(e){return e.props.value===j}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},b.map((function(e,n){return(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==j})}))))}function c(e){var n=(0,o.Z)();return r.createElement(u,(0,s.Z)({key:String(n)},e))}function p(e){var n=e.children,t=e.hidden,s=e.className;return r.createElement("div",{role:"tabpanel",hidden:t,className:s},n)}function d(e){var n=e.NodeJsVsCode,t=e.DotNetVsCode,s=e.DotNetVs2022;return r.createElement(c,{groupId:"development-environment"},r.createElement(p,{value:"nodejs-vscode",label:"Node.js & VSCode",default:!0},r.createElement(n,null)),r.createElement(p,{value:"dotnet-vscode",label:".NET 6 & VSCode"},r.createElement(t,null)),r.createElement(p,{value:"dotnet-vs2022",label:".NET 6 & VS2022"},r.createElement(s,null)))}},9829:function(e,n,t){t.r(n),t.d(n,{assets:function(){return j},contentTitle:function(){return w},default:function(){return I},frontMatter:function(){return y},metadata:function(){return C},toc:function(){return T}});var r=t(7462),s=t(3366),o=(t(7294),t(3905)),a=t(8843),i=["components"],l={toc:[]};function u(e){var n=e.components,t=(0,s.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Update the ",(0,o.kt)("inlineCode",{parentName:"p"},"services/forge.js")," file with the following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="services/forge.js"',title:'"services/forge.js"'},"// highlight-start\nconst { AuthClientThreeLegged, UserProfileApi, HubsApi, ProjectsApi, FoldersApi, ItemsApi } = require('forge-apis');\n// highlight-end\nconst { FORGE_CLIENT_ID, FORGE_CLIENT_SECRET, FORGE_CALLBACK_URL, INTERNAL_TOKEN_SCOPES, PUBLIC_TOKEN_SCOPES } = require('../config.js');\n\nconst internalAuthClient = new AuthClientThreeLegged(FORGE_CLIENT_ID, FORGE_CLIENT_SECRET, FORGE_CALLBACK_URL, INTERNAL_TOKEN_SCOPES);\nconst publicAuthClient = new AuthClientThreeLegged(FORGE_CLIENT_ID, FORGE_CLIENT_SECRET, FORGE_CALLBACK_URL, PUBLIC_TOKEN_SCOPES);\n\nfunction getAuthorizationUrl() {\n    return internalAuthClient.generateAuthUrl();\n}\n\nasync function authCallbackMiddleware(req, res, next) {\n    const internalCredentials = await internalAuthClient.getToken(req.query.code);\n    const publicCredentials = await publicAuthClient.refreshToken(internalCredentials);\n    req.session.public_token = publicCredentials.access_token;\n    req.session.internal_token = internalCredentials.access_token;\n    req.session.refresh_token = publicCredentials.refresh_token;\n    req.session.expires_at = Date.now() + internalCredentials.expires_in * 1000;\n    next();\n}\n\nasync function authRefreshMiddleware(req, res, next) {\n    const { refresh_token, expires_at } = req.session;\n    if (!refresh_token) {\n        res.status(401).end();\n        return;\n    }\n\n    if (expires_at < Date.now()) {\n        const internalCredentials = await internalAuthClient.refreshToken({ refresh_token });\n        const publicCredentials = await publicAuthClient.refreshToken(internalCredentials);\n        req.session.public_token = publicCredentials.access_token;\n        req.session.internal_token = internalCredentials.access_token;\n        req.session.refresh_token = publicCredentials.refresh_token;\n        req.session.expires_at = Date.now() + internalCredentials.expires_in * 1000;\n    }\n    req.internalOAuthToken = {\n        access_token: req.session.internal_token,\n        expires_in: Math.round((req.session.expires_at - Date.now()) / 1000)\n    };\n    req.publicOAuthToken = {\n        access_token: req.session.public_token,\n        expires_in: Math.round((req.session.expires_at - Date.now()) / 1000)\n    };\n    next();\n}\n\nasync function getUserProfile(token) {\n    const resp = await new UserProfileApi().getUserProfile(internalAuthClient, token);\n    return resp.body;\n}\n\n// highlight-start\nasync function getHubs(token) {\n    const resp = await new HubsApi().getHubs(null, internalAuthClient, token);\n    return resp.body.data;\n}\n\nasync function getProjects(hubId, token) {\n    const resp = await new ProjectsApi().getHubProjects(hubId, null, internalAuthClient, token);\n    return resp.body.data;\n}\n\nasync function getProjectContents(hubId, projectId, folderId, token) {\n    if (!folderId) {\n        const resp = await new ProjectsApi().getProjectTopFolders(hubId, projectId, internalAuthClient, token);\n        return resp.body.data;\n    } else {\n        const resp = await new FoldersApi().getFolderContents(projectId, folderId, null, internalAuthClient, token);\n        return resp.body.data;\n    }\n}\n\nasync function getItemVersions(projectId, itemId, token) {\n    const resp = await new ItemsApi().getItemVersions(projectId, itemId, null, internalAuthClient, token);\n    return resp.body.data;\n}\n// highlight-end\n\nmodule.exports = {\n    getAuthorizationUrl,\n    authCallbackMiddleware,\n    authRefreshMiddleware,\n    getUserProfile,\n    // highlight-start\n    getHubs,\n    getProjects,\n    getProjectContents,\n    getItemVersions\n    // highlight-end\n};\n")))}u.isMDXComponent=!0;var c=["components"],p={toc:[]};function d(e){var n=e.components,t=(0,s.Z)(e,c);return(0,o.kt)("wrapper",(0,r.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Create a ",(0,o.kt)("inlineCode",{parentName:"p"},"hubs.js")," file under the ",(0,o.kt)("inlineCode",{parentName:"p"},"routes")," subfolder with the following content:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="routes/hubs.js"',title:'"routes/hubs.js"'},"const express = require('express');\nconst { authRefreshMiddleware, getHubs, getProjects, getProjectContents, getItemVersions } = require('../services/forge.js');\n\nlet router = express.Router();\n\nrouter.use(authRefreshMiddleware);\n\nrouter.get('/', async function (req, res, next) {\n    try {\n        const hubs = await getHubs(req.internalOAuthToken);\n        res.json(hubs);\n    } catch (err) {\n        next(err);\n    }\n});\n\nrouter.get('/:hub_id/projects', async function (req, res, next) {\n    try {\n        const projects = await getProjects(req.params.hub_id, req.internalOAuthToken);\n        res.json(projects);\n    } catch (err) {\n        next(err);\n    }\n});\n\nrouter.get('/:hub_id/projects/:project_id/contents', async function (req, res, next) {\n    try {\n        const contents = await getProjectContents(req.params.hub_id, req.params.project_id, req.query.folder_id, req.internalOAuthToken);\n        res.json(contents);\n    } catch (err) {\n        next(err);\n    }\n});\n\nrouter.get('/:hub_id/projects/:project_id/contents/:item_id/versions', async function (req, res, next) {\n    try {\n        const versions = await getItemVersions(req.params.project_id, req.params.item_id, req.internalOAuthToken);\n        res.json(versions);\n    } catch (err) {\n        next(err);\n    }\n});\n\nmodule.exports = router;\n")),(0,o.kt)("p",null,"And mount the router to our server application by modifying ",(0,o.kt)("inlineCode",{parentName:"p"},"server.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="server.js"',title:'"server.js"'},"const express = require('express');\nconst session = require('cookie-session')\nconst { PORT, SERVER_SESSION_SECRET } = require('./config.js');\n\nlet app = express();\napp.use(express.static('wwwroot'));\napp.use(session({ secret: SERVER_SESSION_SECRET, maxAge: 24 * 60 * 60 * 1000 }));\napp.use('/api/auth', require('./routes/auth.js'));\n// highlight-start\napp.use('/api/hubs', require('./routes/hubs.js'));\n// highlight-end\napp.listen(PORT, () => console.log(`Server listening on port ${PORT}...`));\n")))}d.isMDXComponent=!0;var h=["components"],g={toc:[]};function b(e){var n=e.components,t=(0,s.Z)(e,h);return(0,o.kt)("wrapper",(0,r.Z)({},g,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Create a ",(0,o.kt)("inlineCode",{parentName:"p"},"ForgeService.Hubs.cs")," under the ",(0,o.kt)("inlineCode",{parentName:"p"},"Models")," subfolder with the following content:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp",metastring:'title="Models/ForgeService.Hubs.cs"',title:'"Models/ForgeService.Hubs.cs"'},"using System.Collections.Generic;\nusing System.Threading.Tasks;\nusing Autodesk.Forge;\nusing Autodesk.Forge.Model;\n\npublic partial class ForgeService\n{\n    public async Task<IEnumerable<dynamic>> GetHubs(Tokens tokens)\n    {\n        var hubs = new List<dynamic>();\n        var api = new HubsApi();\n        api.Configuration.AccessToken = tokens.InternalToken;\n        var response = await api.GetHubsAsync();\n        foreach (KeyValuePair<string, dynamic> hub in new DynamicDictionaryItems(response.data))\n        {\n            hubs.Add(hub.Value);\n        }\n        return hubs;\n    }\n\n    public async Task<IEnumerable<dynamic>> GetProjects(string hubId, Tokens tokens)\n    {\n        var projects = new List<dynamic>();\n        var api = new ProjectsApi();\n        api.Configuration.AccessToken = tokens.InternalToken;\n        var response = await api.GetHubProjectsAsync(hubId);\n        foreach (KeyValuePair<string, dynamic> project in new DynamicDictionaryItems(response.data))\n        {\n            projects.Add(project.Value);\n        }\n        return projects;\n    }\n\n    public async Task<IEnumerable<dynamic>> GetContents(string hubId, string projectId, string folderId, Tokens tokens)\n    {\n        var contents = new List<dynamic>();\n        if (string.IsNullOrEmpty(folderId))\n        {\n            var api = new ProjectsApi();\n            api.Configuration.AccessToken = tokens.InternalToken;\n            var response = await api.GetProjectTopFoldersAsync(hubId, projectId);\n            foreach (KeyValuePair<string, dynamic> folders in new DynamicDictionaryItems(response.data))\n            {\n                contents.Add(folders.Value);\n            }\n        }\n        else\n        {\n            var api = new FoldersApi();\n            api.Configuration.AccessToken = tokens.InternalToken;\n            var response = await api.GetFolderContentsAsync(projectId, folderId); // TODO: add paging\n            foreach (KeyValuePair<string, dynamic> item in new DynamicDictionaryItems(response.data))\n            {\n                contents.Add(item.Value);\n            }\n        }\n        return contents;\n    }\n\n    public async Task<IEnumerable<dynamic>> GetVersions(string hubId, string projectId, string itemId, Tokens tokens)\n    {\n        var versions = new List<dynamic>();\n        var api = new ItemsApi();\n        api.Configuration.AccessToken = tokens.InternalToken;\n        var response = await api.GetItemVersionsAsync(projectId, itemId);\n        foreach (KeyValuePair<string, dynamic> version in new DynamicDictionaryItems(response.data))\n        {\n            versions.Add(version.Value);\n        }\n        return versions;\n    }\n}\n")))}b.isMDXComponent=!0;var f=["components"],m={toc:[]};function v(e){var n=e.components,t=(0,s.Z)(e,f);return(0,o.kt)("wrapper",(0,r.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Create a ",(0,o.kt)("inlineCode",{parentName:"p"},"HubsController.cs")," file under the ",(0,o.kt)("inlineCode",{parentName:"p"},"Controllers")," subfolder with the following content:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp",metastring:'title="Controllers/HubsController.cs"',title:'"Controllers/HubsController.cs"'},'using System.Threading.Tasks;\nusing Microsoft.AspNetCore.Mvc;\nusing Microsoft.Extensions.Logging;\nusing Newtonsoft.Json;\n\n[ApiController]\n[Route("api/[controller]")]\npublic class HubsController : ControllerBase\n{\n    private readonly ILogger<HubsController> _logger;\n    private readonly ForgeService _forgeService;\n\n    public HubsController(ILogger<HubsController> logger, ForgeService forgeService)\n    {\n        _logger = logger;\n        _forgeService = forgeService;\n    }\n\n    [HttpGet()]\n    public async Task<ActionResult<string>> ListHubs()\n    {\n        var tokens = await AuthController.PrepareTokens(Request, Response, _forgeService);\n        if (tokens == null)\n        {\n            return Unauthorized();\n        }\n        var hubs = await _forgeService.GetHubs(tokens);\n        return JsonConvert.SerializeObject(hubs);\n    }\n\n    [HttpGet("{hub}/projects")]\n    public async Task<ActionResult<string>> ListProjects(string hub)\n    {\n        var tokens = await AuthController.PrepareTokens(Request, Response, _forgeService);\n        if (tokens == null)\n        {\n            return Unauthorized();\n        }\n        var projects = await _forgeService.GetProjects(hub, tokens);\n        return JsonConvert.SerializeObject(projects);\n    }\n\n    [HttpGet("{hub}/projects/{project}/contents")]\n    public async Task<ActionResult<string>> ListItems(string hub, string project, [FromQuery] string? folder_id)\n    {\n        var tokens = await AuthController.PrepareTokens(Request, Response, _forgeService);\n        if (tokens == null)\n        {\n            return Unauthorized();\n        }\n        var contents = await _forgeService.GetContents(hub, project, folder_id, tokens);\n        return JsonConvert.SerializeObject(contents);\n    }\n\n    [HttpGet("{hub}/projects/{project}/contents/{item}/versions")]\n    public async Task<ActionResult<string>> ListVersions(string hub, string project, string item)\n    {\n        var tokens = await AuthController.PrepareTokens(Request, Response, _forgeService);\n        if (tokens == null)\n        {\n            return Unauthorized();\n        }\n        var versions = await _forgeService.GetVersions(hub, project, item, tokens);\n        return JsonConvert.SerializeObject(versions);\n    }\n}\n')),(0,o.kt)("p",null,"The controller handles several endpoints for browsing the content in 3rd party Forge\napplications such as BIM 360 Docs and ACC. We will make use of these endpoints when\nbuilding the UI part of the application."))}v.isMDXComponent=!0;var k=["components"],y={},w="Data Browsing",C={unversionedId:"tutorials/hubs-browser/data",id:"tutorials/hubs-browser/data",title:"Data Browsing",description:"In this step we'll extend our server so that we can browse the content of 3rd party",source:"@site/docs/tutorials/02-hubs-browser/03-data.mdx",sourceDirName:"tutorials/02-hubs-browser",slug:"/tutorials/hubs-browser/data",permalink:"/forge-samples-docs/docs/tutorials/hubs-browser/data",editUrl:"https://github.com/petrbroz/forge-samples-docs/edit/master/docs/tutorials/02-hubs-browser/03-data.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Authentication",permalink:"/forge-samples-docs/docs/tutorials/hubs-browser/auth"},next:{title:"Viewer & UI",permalink:"/forge-samples-docs/docs/tutorials/hubs-browser/viewer"}},j={},T=[{value:"Browsing hubs",id:"browsing-hubs",level:2},{value:"Server endpoints",id:"server-endpoints",level:2},{value:"Try it out",id:"try-it-out",level:2}],_={toc:T};function I(e){var n=e.components,i=(0,s.Z)(e,k);return(0,o.kt)("wrapper",(0,r.Z)({},_,i,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"data-browsing"},"Data Browsing"),(0,o.kt)("p",null,"In this step we'll extend our server so that we can browse the content of 3rd party\napplications built with Forge such as BIM 360 Docs or ACC."),(0,o.kt)("h2",{id:"browsing-hubs"},"Browsing hubs"),(0,o.kt)("p",null,"First, let's add a couple of helper methods for browsing through Data Management hubs,\nprojects, folders, items, and versions."),(0,o.kt)(a.Z,{NodeJsVsCode:u,DotNetVsCode:b,DotNetVs2022:b,mdxType:"EnvTabs"}),(0,o.kt)("h2",{id:"server-endpoints"},"Server endpoints"),(0,o.kt)("p",null,"Next, let's expose the new functionality to the client-side code through another\nset of endpoints."),(0,o.kt)(a.Z,{NodeJsVsCode:d,DotNetVsCode:v,DotNetVs2022:v,mdxType:"EnvTabs"}),(0,o.kt)("h2",{id:"try-it-out"},"Try it out"),(0,o.kt)("p",null,"And that's it for the server side. Time to try it out!"),(0,o.kt)("p",null,"Start (or restart) the app from Visual Studio Code as usual, and navigate to\n",(0,o.kt)("a",{parentName:"p",href:"http://localhost:8080/api/hubs"},"http://localhost:8080/api/hubs")," in the browser.\nThe server should respond with a JSON list of all the hubs you have access to.\nTry copying the ID of one of the hubs, and use it in another address: http://localhost:8080/api/hubs/your-hub-id/projects.\nIn this case the server application should respond with a JSON list of all projects\navailable under the specified hub."),(0,o.kt)("p",null,(0,o.kt)("img",{loading:"lazy",alt:"Hubs Response",src:t(7900).Z,width:"1500",height:"929"})))}I.isMDXComponent=!0},7900:function(e,n,t){n.Z=t.p+"assets/images/hubs-response-331b6b1027c663dae5bf900e5ca9e1b8.png"}}]);